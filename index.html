<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Season 3 - Fusion Feast</title>
  
  <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;600;800;900&display=swap" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  
  <link href="style-global.css" rel="stylesheet">
  <link href="style.css" rel="stylesheet">

  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

  <script src="constants.js"></script>          <script src="sync-manager.js"></script>        <script src="theme-manager.js"></script>       <script src="drag-drop-manager.js"></script>   <script src="export-manager.js"></script>       <script src="main.js"></script>
  <script src="chat-manager.js"></script> </head>
<body>
  
  <div id="settings-modal" onclick="if(event.target===this) toggleSettings()">
      <div class="modal-box">
          <div class="modal-header">
              <div class="modal-title">DASHBOARD SETTINGS</div>
              <div class="modal-close" onclick="toggleSettings()">&times;</div>
          </div>
          
          <div class="section-box">
              <div class="setting-label">WHO ARE YOU?</div>
              <div class="flex-row">
                  <button class="who-btn" id="role-p1" onclick="setIdentity('p1')">Player 1</button>
                  <button class="who-btn" id="role-p2" onclick="setIdentity('p2')">Player 2</button>
                  <button class="who-btn" id="role-spec" onclick="setIdentity('spectator')">Spectator</button>
              </div>
          </div>

          <div class="player-grid">
              <div class="section-box">
                  <div class="setting-label">PLAYER 1 CONFIG</div>
                  <div class="flex-row">
                      <input type="text" id="st-p1-name" class="st-input" placeholder="Name" onchange="saveConfig('p1Name', this.value)">
                      <input type="color" id="st-p1-color" class="st-color" onchange="saveConfig('p1Color', this.value)">
                  </div>
              </div>
              <div class="section-box">
                  <div class="setting-label">PLAYER 2 CONFIG</div>
                  <div class="flex-row">
                      <input type="text" id="st-p2-name" class="st-input" placeholder="Name" onchange="saveConfig('p2Name', this.value)">
                      <input type="color" id="st-p2-color" class="st-color" onchange="saveConfig('p2Color', this.value)">
                  </div>
              </div>
          </div>

          <div class="row-grid">
              <div class="setting-group">
                  <div class="setting-label">Global Theme</div>
                  <div class="flex-row">
                      <input type="color" id="st-theme-color" class="st-color" style="width:100%" onchange="saveConfig('theme', this.value)">
                  </div>
              </div>
              <div class="setting-group">
                  <div class="setting-label">Background Color</div>
                  <div class="flex-row">
                      <input type="color" id="st-bg-color" class="st-color" style="width:100%" onchange="saveConfig('bgColor', this.value)">
                  </div>
              </div>
          </div>
          
          <div class="section-box">
              <div class="setting-label">Background Wallpaper</div>
              
              <div id="drop-zone" ondragover="dragOverHandler(event)" ondragleave="dragLeaveHandler(event)" ondrop="dropHandler(event)">
                  DROP IMAGE HERE
              </div>

              <div class="flex-row">
                  <input type="text" id="st-bg-url" class="st-input" placeholder="Paste URL..." onchange="saveConfig('bgUrl', this.value)">
                  <button class="st-btn action" onclick="addCurrentToSaved()">Save</button>
                  <button class="st-btn" onclick="saveConfig('bgUrl', '')">Clear</button>
              </div>
              <div class="saved-grid" id="saved-bg-list"></div>
          </div>

      </div>
  </div>

  <div class="top-bar">
    <div class="top-left">
      <div class="status-badge">
        <div id="status-dot" class="status-dot active"></div> 
        <span>Live</span>
        <div id="presence-count" class="online-count"><i class="fas fa-users" style="font-size: 11px;"></i> 0</div>
        
        <div class="chat-trigger" onclick="toggleChat()" title="Open Chat">
            <i class="fas fa-comment-alt"></i>
        </div>
      </div>
    </div>

    <div class="top-center">
        <div class="np-widget">
            <img id="np-img-top" class="np-thumb-mini" src="">
            <div class="np-info">
                <div class="np-scroll-wrapper">
                    <div class="np-text" id="np-title-top">System Ready</div>
                </div>
            </div>
            
            <div class="np-controls">
                <button class="media-tiny-btn" onclick="mediaAction('prev')"><span class="material-icons">skip_previous</span></button>
                <button class="media-tiny-btn" onclick="mediaAction('play')" id="top-play-btn"><span class="material-icons">play_arrow</span></button>
                <button class="media-tiny-btn" onclick="mediaAction('next')"><span class="material-icons">skip_next</span></button>
            </div>

            <div class="top-vol">
                <button class="media-tiny-btn" onclick="toggleTopMute()" style="width:24px;"><span class="material-icons" id="top-vol-icon" style="font-size:18px;">volume_up</span></button>
                <input type="range" class="top-vol-slider" id="top-vol-slider" min="0" max="100" value="100" oninput="sendVolume(this.value)">
            </div>
        </div>
    </div>

    <div class="top-right">
      <div class="theme-btn-group">
        <div class="theme-color-btn" onclick="window.changeTheme()" title="Quick Random Theme"><i class="fas fa-palette"></i></div>
        <div class="theme-party-btn" onclick="window.toggleParty()" title="Party Mode"><i class="fas fa-infinity"></i></div>
        <div class="theme-gear-btn" onclick="toggleFullScreen()" title="Toggle Fullscreen"><i class="fas fa-expand" id="fs-icon"></i></div>
        <div class="theme-gear-btn" onclick="toggleSettings()" title="Settings"><i class="fas fa-cog"></i></div>
      </div>
    </div>
  </div>

  <div class="stage">
    
    <div class="col-p" id="col-alb">
      <div class="p-header">
          <div class="p-name" id="disp-p1-name" style="color:var(--p1-color)">P1</div>
          <div class="p-score" id="score-alb">0</div>
          <div class="p-ctrls">
              <div class="tiny-btn" onclick="modScore('alb', 'add')">+</div>
              <div class="tiny-btn" onclick="modScore('alb', 'sub')">-</div>
          </div>
      </div>
      
      <div class="ctrl-row">
          <button class="col-btn collapse-btn" onclick="toggleCollapse()" title="Collapse/Expand">
              <i class="fas fa-compress-alt"></i>
          </button>
          <button class="col-btn export" id="export-alb" onclick="exportTeam('alb')" title="Export to Showdown">
              <i class="fas fa-file-export"></i> Export Team
          </button>
      </div>

      <div class="mini-row" id="mini-alb"></div>
      <div class="slot-list" id="slots-alb"></div>
      <button class="col-btn clear-btn" onclick="clearCol('alb')">Clear</button>
    </div>

    <div class="col-c">
      <div class="tab-bar">
        <button class="tab-btn-collapse" onclick="toggleAll()" title="Collapse/Expand Window">
            <i class="fas fa-compress-alt" id="c-collapse-icon"></i>
        </button>

        <div class="tab track-hover" data-id="tab-battle" onclick="switchTab('battle', this)" style="padding:0 15px;">
            <i class="material-icons" style="font-size:22px;">catching_pokemon</i>
        </div>

        <div class="tab active track-hover" data-id="tab-play" onclick="switchTab('play', this)">
            Play
            <div class="tab-badges"></div>
        </div>
        <div class="tab track-hover" data-id="tab-gen" onclick="switchTab('gen', this)">
            Generator
            <div class="tab-badges"></div>
        </div>
        <div class="tab track-hover" data-id="tab-music" onclick="switchTab('music', this)">
            Music
            <div class="tab-badges"></div>
        </div>
        <div class="tab track-hover" data-id="tab-hist" onclick="switchTab('hist', this)">
            History
            <div class="tab-badges"></div>
        </div>
        <div class="tab track-hover" data-id="tab-lib" onclick="switchTab('lib', this)">
            Library
            <div class="tab-badges"></div>
        </div>
      </div>
      
      <div id="view-battle" class="tab-content"><iframe id="frame-battle" src="battle.html" style="width:100%;height:100%;border:none;"></iframe></div>

      <div id="view-play" class="tab-content active"><iframe id="frame-play" src="play.html" style="width:100%;height:100%;border:none;"></iframe></div>
      
      <div id="view-gen" class="tab-content" ondragover="allowReturnDrop(event)" ondrop="returnDrop(event)">
        <iframe id="frame-gen" src="gen.html" style="width:100%;height:100%;border:none; pointer-events:all;"></iframe>
      </div>
      
      <div id="view-music" class="tab-content"><iframe id="frame-music" src="music.html" style="width:100%;height:100%;border:none;"></iframe></div>
      
      <div id="view-hist" class="tab-content"><iframe id="frame-hist" src="history.html" style="width:100%;height:100%;border:none;"></iframe></div>

      <div id="view-lib" class="tab-content">
          <iframe id="frame-lib" src="library.html" style="width:100%;height:100%;border:none;"></iframe>
      </div>
    </div>

    <div class="col-p" id="col-biu">
      <div class="p-header">
          <div class="p-name" id="disp-p2-name" style="color:var(--p2-color)">P2</div>
          <div class="p-score" id="score-biu">0</div>
          <div class="p-ctrls">
              <div class="tiny-btn" onclick="modScore('biu', 'add')">+</div>
              <div class="tiny-btn" onclick="modScore('biu', 'sub')">-</div>
          </div>
      </div>

      <div class="ctrl-row">
          <button class="col-btn collapse-btn" onclick="toggleCollapse()" title="Collapse/Expand">
              <i class="fas fa-compress-alt"></i>
          </button>
          <button class="col-btn export" id="export-biu" onclick="exportTeam('biu')" title="Export to Showdown">
              <i class="fas fa-file-export"></i> Export Team
          </button>
      </div>

      <div class="mini-row" id="mini-biu"></div>
      <div class="slot-list" id="slots-biu"></div>
      <button class="col-btn clear-btn" onclick="clearCol('biu')">Clear</button>
    </div>
  </div>

  <div id="chat-window" class="chat-window">
      <div id="chat-header" class="chat-header">
          <span class="chat-title">Live Chat</span>
          <span class="chat-close" onclick="toggleChat()">&times;</span>
      </div>
      <div class="chat-content">
          <div id="chat-output" class="chat-output">
              <div class="chat-msg"><span class="chat-text" style="color:#666; font-style:italic;">Welcome to the chat...</span></div>
          </div>
          <div class="chat-input-area">
              <input id="chat-input" class="chat-input" placeholder="Type..." autocomplete="off">
              <button class="chat-send-btn" onclick="sendMessage()">></button>
          </div>
      </div>
  </div>

</body>
</html>